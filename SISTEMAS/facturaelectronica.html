<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CONTPAQi Factura Electr√≥nica | Expiriti</title>
<meta name="description" content="CONTPAQi Factura Electr√≥nica con Expiriti: Emite CFDI 4.0 (facturas, REP, Carta Porte 3.1) f√°cil y r√°pido. Timbrado ilimitado. Ideal para PyMEs y personas f√≠sicas.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<link rel="apple-touch-icon" sizes="180x180" href="../IMG/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../IMG/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../IMG/favicon-16x16.png">
<link rel="manifest" href="../IMG/site.webmanifest">
<link rel="icon" href="../IMG/favicon.ico">
<link rel="icon" type="image/png" sizes="192x192" href="../IMG/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="../IMG/android-chrome-512x512.png">

<style>
:root{
  --bg:#0b0f14;--card:#111723;--muted:#95a2b3;--text:#e8eef6;
  --brand:#2dd4bf;--brand-2:#60a5fa;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
  --maxw:1200px;--radius:14px;--shadow:0 10px 30px rgba(0,0,0,.25)
}
*{box-sizing:border-box}
html,body{margin:0;height:100%}
html{scroll-behavior:smooth}
body{
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:linear-gradient(180deg,#0b0f14 0%, #0d1219 100%); color:var(--text);
  scroll-padding-top:84px;
}
a{color:inherit;text-decoration:none}
img,video,iframe{max-width:100%;display:block}
.container{max-width:var(--maxw);margin:0 auto;padding:0 34px}

/* Header fijo */
header{
  position:sticky; top:0; z-index:1000; width:100%;
  background:rgba(11,15,20,.75); backdrop-filter:saturate(140%) blur(8px);
  border-bottom:1px solid #19202b;
}
.nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 0}
.brand{display:flex;align-items:center;gap:10px;font-weight:700}
.brand img{width:38px;height:38px;border-radius:10px;display:block}
.brand small{display:block;font-weight:500;color:var(--muted);font-size:12px;margin-top:2px}
nav ul{list-style:none;display:flex;gap:18px;margin:0;padding:0}
nav a{opacity:.9} nav a:hover{opacity:1}
.cta{display:flex;gap:10px;align-items:center}
.burger{display:none}

/* Botones */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #1c2533;background:#121a25;box-shadow:var(--shadow);font-weight:700;font-size:14px;cursor:pointer;white-space:nowrap}
.btn-grad-green{background:linear-gradient(145deg,#16a34a,#22c55e);color:#0b0f14;border:none}
.btn-grad-purple{background:linear-gradient(145deg,#7c3aed,#a855f7);color:#fff;border:none}
.btn-grad-blue{background:linear-gradient(145deg,#2563eb,#3b82f6);color:#fff;border:none}
.btn-ghost{background:#121a25;color:#e8eef6}
.btn-outline-gradient{color:#cfe9ff;background:transparent;border:1px solid transparent;position:relative;overflow:hidden}
.btn-outline-gradient::before{content:"";position:absolute;inset:0;padding:1px;border-radius:12px;background:linear-gradient(145deg,var(--brand),var(--brand-2));-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude}

/* T√≠tulos / badges */
.hero{padding:26px 0 0}
h1{font-size:clamp(28px,3.4vw,42px);line-height:1.1;margin:8px 0 14px}
h2,h3,h4{margin:0 0 10px}
.lead{color:#c6d1e3;font-size:18px;max-width:68ch}
.hint{color:#aebbd0;opacity:.9}
.badges{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 0}
.badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#0f1c2c;border:1px solid #203044;color:#cfe3ff;font-size:12px}
.lock-note{margin:8px 0 0;font-size:12px;color:#94a8c6;display:inline-flex;gap:6px;align-items:center}
.lock-note::before{content:"‚ö†Ô∏è";}
section{padding:26px 0;border-top:1px solid #11182725}
.card{background:var(--card);border:1px solid #1c2533;border-radius:16px;overflow:hidden}
.card .body{padding:12px;color:#c8d3e5}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:start}
.grid-2.align-center{align-items:center}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.stack{display:grid;gap:12px}
.title-gradient{background:linear-gradient(90deg,var(--brand),var(--brand-2));-webkit-background-clip:text;background-clip:text;color:transparent}

/* ===== HERO 3 columnas ===== */
.hero-3col{display:grid;grid-template-columns:280px 1.55fr 1.05fr;column-gap:8px;align-items:start}
@media (max-width:1200px){ .hero-3col{grid-template-columns:270px 1.45fr 1.05fr} }
@media (max-width:980px){ .hero-3col{grid-template-columns:1fr} }
.stack-left{display:grid;gap:10px;align-items:start;justify-items:start}
.pdf-card{margin-left:-6px}
.pdf-frame{width:100%;height:68vh;border:0}
@media (max-width:980px){ .pdf-frame{height:56vh} }

/* === Botones Hero hover === */
.hero-btn {transition: transform .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease}
.hero-btn:hover {transform: translateY(-3px); box-shadow: 0 10px 26px rgba(0,0,0,.35)}
.hero-btn.btn-grad-green:hover {box-shadow: 0 10px 26px rgba(34,197,94,.3)}
.hero-btn.btn-grad-purple:hover {box-shadow: 0 10px 26px rgba(168,85,247,.3)}
.hero-btn.btn-grad-blue:hover {box-shadow: 0 10px 26px rgba(59,130,246,.3)}
.hero-btn.btn-ghost:hover {background:#192636;border-color:#2a3c52}

/* ===== Galer√≠a portada ===== */
.carousel{position:relative;border-radius:var(--radius);overflow:hidden;border:1px solid #1c2533;background:#0f1622;min-height:420px}
.carousel-track{display:flex;scroll-snap-type:x mandatory;overflow-x:auto;scroll-behavior:smooth;height:calc(100% - 38px)}
.carousel-slide{min-width:100%;width:100%;height:100%;object-fit:cover;display:block}
.carousel-nav{display:flex;gap:8px;justify-content:center;padding:10px;background:#0e1724;border-top:1px solid #1c2533}
.dot{width:10px;height:10px;border-radius:999px;background:#223044;border:none;opacity:.6}
.dot.active{background:linear-gradient(145deg,var(--brand),var(--brand-2));opacity:1}
.arrowCircle{position:absolute;top:50%;transform:translateY(-50%);width:44px;height:44px;border-radius:999px;border:1px solid #2b3c56;background:linear-gradient(145deg,#0f1a2a,#0f1c2c);display:grid;place-items:center;cursor:pointer;z-index:3;color:#eaf2ff;box-shadow:0 6px 18px rgba(0,0,0,.35)}
.arrowCircle.prev{left:8px}.arrowCircle.next{right:8px}.arrowCircle .chev{font-size:24px;line-height:1}

/* ===== Carrusel de sistemas ===== */
.carouselX{position:relative;border-radius:16px;background:#0e1826;border:1px solid #1c2533;padding:8px}
.carouselX .track{display:flex;gap:12px;overflow:hidden;padding:4px;min-height:220px}
.carouselX .sys{flex:0 0 calc((100% - 24px)/3);background:#0f1622;border:1px solid #1c2533;border-radius:14px;padding:16px;display:flex;flex-direction:column;align-items:center;text-align:center}
.carouselX .sys img{width:72px;height:72px;border-radius:16px;margin:6px auto 10px;background:#101826;object-fit:cover}
.group-dots{display:flex;gap:8px;justify-content:center;margin:8px 0 0 0}
.group-dots .dot.active{background:linear-gradient(145deg,var(--brand),var(--brand-2))}

/* ===== CALCULADORA ===== */
.calc-strip{display:flex;flex-direction:column;gap:12px}
.calc-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:stretch}
.calc-row.has-three{grid-template-columns:1fr 1fr 1fr}
.calc-container{border:1px solid #1c2533;border-radius:12px;background:#0f1622;padding:12px}
.placeholder{border:1px dashed #26405f;background:#0e1724;border-radius:12px;display:flex;align-items:center;justify-content:center;padding:14px;min-height:180px}
.placeholder .note{text-align:center;color:#b9c8de}
#calc-primary{grid-column:1}
#calc-slot-2,#calc-secondary{grid-column:2}
#calc-tertiary{grid-column:3;display:none}
#add-more-panel{grid-column:1 / -1}

.calc-container h4{margin:0 0 8px}
.calc-container table{width:100%;max-width:640px;margin:0 auto;border-collapse:separate;border-spacing:0;border:1px solid #1e2b3c;border-radius:10px;overflow:hidden;background:#0e1724}
.calc-container thead th{background:#0e1724;color:#dce8ff;text-align:left;border-bottom:1px solid #1e2b3c;font-weight:700}
.calc-container th,.calc-container td{padding:10px 12px;border-bottom:1px solid #1e2b3c}
.calc-container tr:last-child td{border-bottom:none}
.calc-container td:last-child,.calc-container th:last-child{text-align:right}
.calc-container label,.calc-container .control-label{display:block;font-weight:700;color:#cfe3ff;margin:4px 0 4px}
.calc-container select,.calc-container input[type="number"]{width:100%;display:block;padding:8px 10px;border-radius:10px;border:1px solid #243248;background:#0e1724;color:#e8eef6}

/* ===== Pickers ===== */
.icons-wrap{
  display:grid !important;
  grid-template-columns: repeat(3, minmax(128px, 1fr)) !important;
  gap:12px !important;
  justify-items:center !important;
}
@media (max-width:980px){ .icons-wrap{ grid-template-columns: repeat(3, minmax(120px, 1fr)) !important; } }
@media (max-width:680px){ .icons-wrap{ grid-template-columns: repeat(2, minmax(120px, 1fr)) !important; } }
.icons-wrap .sys-icon{
  width:100% !important; padding:10px; border-radius:12px;
  border:1px solid #1e2b3c; background:#0e1724; cursor:pointer;
  display:grid; grid-template-rows:auto auto auto; justify-items:center; row-gap:6px;
  transition:transform .12s ease, box-shadow .12s ease, border-color .15s ease, outline-color .12s ease;
}
.icons-wrap .sys-icon:hover{transform:translateY(-2px);box-shadow:0 10px 22px rgba(0,0,0,.25);border-color:#274061}
.icons-wrap .sys-icon.active{outline:2px solid var(--brand)}
.icons-wrap .sys-icon img{width:56px;height:56px;border-radius:12px}
.icons-wrap .sys-icon strong{font-size:12px;text-align:center}
.icons-wrap .sys-icon .sys-price{color:#9fb2cb;font-size:11px}
.icons-wrap .sys-icon .sin15{font-size:10px;font-weight:700;padding:2px 6px;border:1px solid #1e2b3c;border-radius:999px;background:#0e1724;color:#cfe3ff;justify-self:end}

/* Tabla / FAQ / Footer */
.table-like{width:100%;border-collapse:separate;border-spacing:0;border:1px solid #1e2b3c;border-radius:12px;overflow:hidden}
.table-like th,.table-like td{padding:12px 14px;border-bottom:1px solid #1e2b3c}
.table-like tr:last-child td{border-bottom:none}
.table-like thead th{background:#0e1724;color:#dce8ff;text-align:left}
.table-like .highlight{background:rgba(45,212,191,.08);font-weight:700}

.toc{position:fixed;right:16px;bottom:16px;width:240px;max-height:48vh;overflow:auto;background:rgba(15,24,38,.75);border:1px solid #1c2533;border-radius:14px;padding:12px;display:flex;flex-direction:column;gap:6px;z-index:900;box-shadow:0 10px 24px rgba(0,0,0,.35);backdrop-filter: blur(6px);transition:all .2s ease}
.toc.collapsed{width:auto;max-height:none;padding:6px 10px;border-radius:999px;gap:0}
.toc.collapsed .toc-title,.toc.collapsed a,.toc.collapsed .toc-close{display:none}
.toc-title{font-weight:800;color:#b9c8de;margin-bottom:6px}
.toc a{padding:6px 8px;border-radius:10px;color:#cfe3ff;border:1px solid transparent}
.toc a:hover{border-color:#233347;background:#101b2a}

.faq-wrap{display:grid;gap:10px}
.faq-item{border:1px solid #1e2b3c;border-radius:12px;background:#0f1622;overflow:hidden}
.faq-item>summary{list-style:none;cursor:pointer;padding:12px 14px;font-weight:700;display:flex;align-items:center;gap:8px}
.faq-item>summary::marker{display:none}
.faq-item[open]>summary{background:#0e1724;border-bottom:1px solid #1e2b3c}
.faq-item p{padding:12px 14px;margin:0;color:#cfe3ff}

footer{padding:36px 0 12px;border-top:1px solid #11182725;color:#aebbd0}
.footer-grid{display:grid;gap:18px;grid-template-columns:1.6fr 1.2fr 1.2fr 1fr}
.footer-title{font-weight:700;color:#d8e3f6;margin:0 0 10px}
.contact-list{display:grid;gap:6px;font-size:14px}
.item .ico{width:22px}
.payments-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;align-items:center}
.payments-grid img{max-height:28px;object-fit:contain;filter:grayscale(1);opacity:.9}
.brands-col{display:grid;gap:10px}
.brand-item img{max-height:26px;object-fit:contain;filter:grayscale(.1);background:#0e1520;border:1px solid #1c2533;border-radius:10px;padding:6px}
.ally-col{display:grid;gap:10px;justify-items:end}
.ally-col img{height:46px;object-fit:contain;background:#0e1520;border:1px solid #1c2533;border-radius:10px;padding:8px}
.footer-bottom{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-top:20px;padding-top:12px;border-top:1px solid #1c2533}

/* Responsive */
@media (max-width:980px){
  .grid-2{grid-template-columns:1fr}
  .grid-3{grid-template-columns:1fr}
  nav ul{display:none}
  .burger{display:inline-flex;align-items:center;justify-content:center;width:42px;height:42px;border-radius:10px;border:1px solid #1c2533;background:#101722}
  .mobile{display:none}.mobile.open{display:block}
  .mobile a{display:block;padding:12px 0;border-bottom:1px solid #1c2533}
  .toc{right:10px;bottom:10px;width:86vw}
  .footer-grid{grid-template-columns:1fr}
}

/* Videos (horizontales) */
.yt-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:center;justify-items:center}
@media (max-width:768px){ .yt-grid{grid-template-columns:1fr} }
.yt{width:100%;max-width:680px}
.yt iframe{aspect-ratio:16/9;width:100%;border:1px solid #1c2533;border-radius:12px;background:#0e1724}
</style>
</head>
<body id="top">
<header>
  <div class="container nav">
    <a href="#top" class="brand" aria-label="Inicio Expiriti">
      <img src="../IMG/expiritilogo.webp" alt="Expiriti">
      <div>Expiriti<small>Distribuidor CONTPAQi</small></div>
    </a>
    <nav aria-label="Principal">
      <ul>
        <li><a href="#caracteristicas">Funcionalidades</a></li>
        <li><a href="#videos">V√≠deos</a></li>
        <li><a href="#calculadora-section">Precio</a></li>
        <li><a href="#comparativa">Comparativa</a></li>
        <li><a href="#faq">Preguntas frecuentes</a></li>
        <li><a href="#sesion-guiada">Contacto</a></li>
      </ul>
    </nav>
    <div class="cta">
      <a class="btn btn-ghost" href="tel:+525568437918" aria-label="Llamar 55 6843 7918">55 6843 7918</a>
      <a class="btn btn-ghost" href="https://wa.me/5568437918?text=Hola%20Expiriti%2C%20quiero%20informaci%C3%B3n%20de%20CONTPAQi%20Factura%20Electr%C3%B3nica" target="_blank" rel="noopener">WhatsApp</a>
      <button class="burger" id="burger" aria-label="Abrir men√∫">‚â°</button>
    </div>
  </div>
  <div class="container mobile" id="mobileMenu" aria-label="Men√∫ m√≥vil">
    <a href="#caracteristicas">Funcionalidades</a>
    <a href="#videos">V√≠deos</a>
    <a href="#calculadora-section">Precio</a>
    <a href="#comparativa">Comparativa</a>
    <a href="#faq">Preguntas frecuentes</a>
    <a href="#sesion-guiada">Contacto</a>
  </div>
</header>

<main class="container hero">
  <a class="hint" href="https://universalunidad-ux.github.io/unidaduniversal.github.io/#productos" rel="noopener">‚Üê Volver a productos</a>
  <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>
  <h1>CONTPAQi Factura Electr√≥nica <span class="badge">Actualizado 2025</span></h1>

  <div class="badges" role="list" aria-label="Caracter√≠sticas destacadas">
    <span class="badge" role="listitem">Emisi√≥n CFDI 4.0 (Factura, REP, Notas)</span>
    <span class="badge" role="listitem" style="background:rgba(245, 158, 11, 0.15); border-color:#f59e0b; color:#fbbf24;">Emisi√≥n F√°cil Carta Porte 3.1</span>
    <span class="badge" role="listitem">Timbrado Ilimitado</span>
    <span class="badge" role="listitem">Multi RFC</span>
    <span class="badge" role="listitem">F√°cil de Usar</span>
  </div>
  <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>

  <section aria-label="Resumen">
    <div class="card body">
      <div class="hero-3col">
        <div class="stack-left">
          <img src="../IMG/factura.webp" alt="CONTPAQi Factura Electr√≥nica" style="width:220px;margin-bottom:12px;border-radius:12px" loading="lazy">
          <div class="stack">
            <a class="btn btn-grad-green hero-btn" href="https://wa.me/5568437918?text=Hola%20Expiriti%2C%20quiero%20comprar%20mi%20licencia%20de%20CONTPAQi%20Factura%20Electr%C3%B3nica" target="_blank" rel="noopener">Compra ahora</a>
            <a class="btn btn-grad-purple hero-btn" href="https://wa.me/5568437918?text=Quiero%20tramitar%20mi%20prueba%20de%2030%20d%C3%ADas%20de%20CONTPAQi%20Factura%20Electr%C3%B3nica" target="_blank" rel="noopener">Tramitar prueba 30 d√≠as</a>
            <a class="btn btn-grad-blue hero-btn" href="#sesion-guiada">Sesi√≥n guiada 45 min por Zoom</a>
            <a class="btn btn-ghost hero-btn" href="../PDFS/Ficha_Factura_Electronica.pdf" target="_blank" rel="noopener">Ficha t√©cnica (PDF)</a>
            <a class="btn btn-ghost hero-btn" href="#caracteristicas">Resumen ficha t√©cnica</a>
          </div>
        </div>

        <div class="card body pdf-card">
          <img src="../IMG/usas.jpeg" alt="Equipo usando sistema de facturaci√≥n" style="width:100%;border-radius:10px;margin-bottom:10px" loading="lazy">
          <h4 class="title-gradient" style="margin:0 0 6px">Factura f√°cil y cumple con el SAT</h4>
          <p class="hint" style="margin:0 0 8px">Emite todo tipo de comprobantes fiscales de forma intuitiva y siempre actualizada.</p>

          <!-- Muestra la ficha t√©cnica dentro del hero -->
          <iframe class="pdf-frame" title="Ficha t√©cnica CONTPAQi Factura Electr√≥nica" src="../PDFS/Ficha_Factura_Electronica.pdf#page=1&view=FitH" loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>
          <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px">
            <a class="btn btn-outline-gradient" href="../PDFS/Ficha_Factura_Electronica.pdf" target="_blank" rel="noopener">Abrir en pesta√±a</a>
            <a class="btn btn-outline-gradient" href="../PDFS/Ficha_Factura_Electronica.pdf" download>Descargar</a>
          </div>
        </div>

        <aside class="card body">
          <h4 class="title-gradient">Galer√≠a</h4>
          <div class="carousel" id="carousel1">
            <button class="arrowCircle prev" aria-label="Anterior"><span class="chev">‚Äπ</span></button>
            <div class="carousel-track" role="region" aria-label="Galer√≠a de im√°genes">
              <img class="carousel-slide" src="../IMG/1factura_placeholder.webp" alt="Emisi√≥n r√°pida de facturas CFDI 4.0" loading="lazy">
              <img class="carousel-slide" src="../IMG/2factura_placeholder.webp" alt="Generaci√≥n de Complemento de Pago (REP)" loading="lazy">
              <img class="carousel-slide" src="../IMG/3factura_placeholder.webp" alt="Cat√°logos de clientes y productos" loading="lazy">
              <img class="carousel-slide" src="../IMG/4factura_placeholder.webp" alt="Captura asistida para Carta Porte" loading="lazy">
            </div>
            <button class="arrowCircle next" aria-label="Siguiente"><span class="chev">‚Ä∫</span></button>
            <div class="carousel-nav" aria-label="Paginaci√≥n galer√≠a">
              <button class="dot active" aria-label="Slide 1"></button>
              <button class="dot" aria-label="Slide 2"></button>
              <button class="dot" aria-label="Slide 3"></button>
              <button class="dot" aria-label="Slide 4"></button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <section id="caracteristicas" aria-labelledby="caracteristicas-title">
    <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>
    <div class="card body">
      <h3 id="caracteristicas-title" class="title-gradient">Funciones destacadas</h3>

      <div class="pillbar" role="tablist" aria-label="Categor√≠as de caracter√≠sticas">
        <button class="pill active" data-filter="emision" aria-pressed="true">Emisi√≥n y Timbrado CFDI 4.0</button>
        <button class="pill" data-filter="gestion" aria-pressed="false">Gesti√≥n y Administraci√≥n</button>
        <button class="pill" data-filter="cumplimiento" aria-pressed="false">Cumplimiento y Complementos</button>
      </div>

      <div class="grid-3 feature-grid">
        <!-- Emisi√≥n -->
        <article class="fcard tag-emision"><div class="fhead"><img class="ficon" src="../IMG/ic_cfdi_40.webp" alt="" loading="lazy"><h4>Facturas CFDI 4.0</h4></div><p>Emite facturas electr√≥nicas con todos los requisitos del SAT.</p></article>
        <article class="fcard tag-emision"><div class="fhead"><img class="ficon" src="../IMG/ic_rep.webp" alt="" loading="lazy"><h4>Complemento de Pago (REP 2.0)</h4></div><p>Registra cobros parciales o diferidos con REP.</p></article>
        <article class="fcard tag-emision"><div class="fhead"><img class="ficon" src="../IMG/ic_recibos.webp" alt="" loading="lazy"><h4>Otros Comprobantes</h4></div><p>Honorarios, arrendamiento, notas de cr√©dito, donativos y m√°s.</p></article>
        <article class="fcard tag-emision"><div class="fhead"><img class="ficon" src="../IMG/ic_timbrado_ilimitado.webp" alt="" loading="lazy"><h4>Timbrado Ilimitado</h4></div><p>Sin costo adicional por timbre durante la vigencia.</p></article>
        <article class="fcard tag-emision"><div class="fhead"><img class="ficon" src="../IMG/ic_cancelacion_cfdi.webp" alt="" loading="lazy"><h4>Cancelaci√≥n CFDI</h4></div><p>Con o sin aceptaci√≥n, conforme a reglas SAT.</p></article>
        <article class="fcard tag-emision"><div class="fhead"><img class="ficon" src="../IMG/ic_envio_mail.webp" alt="" loading="lazy"><h4>Env√≠o por Email</h4></div><p>PDF y XML a tus clientes al timbrar.</p></article>

        <!-- Gesti√≥n -->
        <article class="fcard tag-gestion"><div class="fhead"><img class="ficon" src="../IMG/ic_facil_uso.webp" alt="" loading="lazy"><h4>F√°cil de Usar</h4></div><p>Interfaz intuitiva con asistentes paso a paso.</p></article>
        <article class="fcard tag-gestion"><div class="fhead"><img class="ficon" src="../IMG/ic_multi_rfc.webp" alt="" loading="lazy"><h4>Multi RFC</h4></div><p>Administra varios contribuyentes en una misma licencia.</p></article>
        <article class="fcard tag-gestion"><div class="fhead"><img class="ficon" src="../IMG/ic_clientes.webp" alt="" loading="lazy"><h4>Clientes</h4></div><p>Datos fiscales y comerciales centralizados.</p></article>
        <article class="fcard tag-gestion"><div class="fhead"><img class="ficon" src="../IMG/ic_productos.webp" alt="" loading="lazy"><h4>Servicios/Productos</h4></div><p>Conceptos con claves SAT y precios.</p></article>
        <article class="fcard tag-gestion"><div class="fhead"><img class="ficon" src="../IMG/ic_plantillas.webp" alt="" loading="lazy"><h4>Plantillas PDF</h4></div><p>Representaci√≥n impresa personalizable.</p></article>
        <article class="fcard tag-gestion"><div class="fhead"><img class="ficon" src="../IMG/ic_add.webp" alt="" loading="lazy"><h4>Almac√©n Digital (ADD)</h4></div><p>Resguarda y consulta tus CFDI emitidos.</p></article>

        <!-- Cumplimiento -->
        <article class="fcard tag-cumplimiento"><div class="fhead"><img class="ficon" src="../IMG/ic_carta_porte.webp" alt="" loading="lazy"><h4>Carta Porte 3.1</h4></div><p>Asistentes y cat√°logos para emisi√≥n √°gil.</p></article>
        <article class="fcard tag-cumplimiento"><div class="fhead"><img class="ficon" src="../IMG/ic_complementos.webp" alt="" loading="lazy"><h4>Complementos</h4></div><p>INE, Notarios, Donatarias, Comercio Exterior, etc.</p></article>
        <article class="fcard tag-cumplimiento"><div class="fhead"><img class="ficon" src="../IMG/ic_addenda.webp" alt="" loading="lazy"><h4>Addendas</h4></div><p>Soporte para cadenas comerciales espec√≠ficas.</p></article>
        <article class="fcard tag-cumplimiento"><div class="fhead"><img class="ficon" src="../IMG/ic_sat_check.webp" alt="" loading="lazy"><h4>Siempre Actualizado</h4></div><p>Reglas, cat√°logos y validaciones vigentes.</p></article>
        <article class="fcard tag-cumplimiento"><div class="fhead"><img class="ficon" src="../IMG/ic_reportes_fiscales.webp" alt="" loading="lazy"><h4>Reportes</h4></div><p>Facturaci√≥n, pendientes de REP e impuestos.</p></article>
        <article class="fcard tag-cumplimiento"><div class="fhead"><img class="ficon" src="../IMG/ic_integracion_contpaqi.webp" alt="" loading="lazy"><h4>Integraci√≥n Contable</h4></div><p>P√≥lizas de ingresos en Contabilidad/Bancos.</p></article>
      </div>
    </div>
  </section>

  <section id="beneficios" aria-label="Por qu√© usar">
    <div class="grid-2 align-center">
      <div>
        <h2 class="title-gradient">¬øPor qu√© usar Factura Electr√≥nica? <span class="badge">Beneficios clave</span></h2>
        <p class="lead">Emite CFDI, cumple con el SAT (incl. Carta Porte 3.1) y administra tu facturaci√≥n con timbrado ilimitado.</p>
        <div class="listSlider">
          <button class="arrowCircle prev" aria-label="Anterior"><span class="chev">‚Äπ</span></button>
          <div class="listTrack" role="region" aria-label="Beneficios">
            <div class="listPage">
              <div class="listItem"><div class="listIcon"><img src="../IMG/ic_facil_rapido.webp" alt="" loading="lazy"></div><div><strong>EMITE F√ÅCIL Y R√ÅPIDO</strong><div>Interfaz clara para facturar en minutos.</div></div></div>
              <div class="listItem"><div class="listIcon"><img src="../IMG/ic_cumple_sat.webp" alt="" loading="lazy"></div><div><strong>CUMPLE CON EL SAT</strong><div>CFDI 4.0, REP 2.0 y complementos siempre vigentes.</div></div></div>
              <div class="listItem"><div class="listIcon"><img src="../IMG/ic_carta_porte_facil.webp" alt="" loading="lazy"></div><div><strong>CARTA PORTE 3.1</strong><div>Asistentes que simplifican el proceso.</div></div></div>
            </div>
            <div class="listPage">
              <div class="listItem"><div class="listIcon"><img src="../IMG/ic_timbrado_gratis.webp" alt="" loading="lazy"></div><div><strong>TIMBRADO ILIMITADO</strong><div>Sin pagar por CFDI adicional.</div></div></div>
              <div class="listItem"><div class="listIcon"><img src="../IMG/ic_multi_rfc_ok.webp" alt="" loading="lazy"></div><div><strong>IDEAL MULTI-EMPRESA</strong><div>Varios RFCs en una misma instalaci√≥n.</div></div></div>
              <div class="listItem"><div class="listIcon"><img src="../IMG/ic_conecta_contpaqi.webp" alt="" loading="lazy"></div><div><strong>SE INTEGRA</strong><div>Con Contabilidad y Bancos de CONTPAQi.</div></div></div>
            </div>
          </div>
          <button class="arrowCircle next" aria-label="Siguiente"><span class="chev">‚Ä∫</span></button>
        </div>
      </div>
      <div>
        <div class="card body">
          <h4 class="title-gradient" style="margin:0 0 6px">Video (reel)</h4>
          <iframe class="pdf-frame" title="Reel CONTPAQi Factura Electr√≥nica" src="https://www.youtube-nocookie.com/embed/VIDEO_ID_FACTURA_REEL" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen loading="lazy"></iframe>
        </div>
      </div>
    </div>
  </section>

  <section id="videos" aria-labelledby="videos-title">
    <div class="card body">
      <h3 id="videos-title" class="title-gradient">Videos del sistema</h3>
      <div class="yt-grid">
        <div class="yt">
          <iframe
            src="https://www.youtube.com/embed/VIDEO_ID_FACTURA_1"
            title="Video principal CONTPAQi Factura Electr√≥nica"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
            loading="lazy">
          </iframe>
        </div>
        <div class="yt">
          <iframe
            src="https://www.youtube.com/embed/VIDEO_ID_FACTURA_2"
            title="Demo CONTPAQi Factura Electr√≥nica"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
            loading="lazy">
          </iframe>
        </div>
      </div>
    </div>
  </section>

  <section id="integra" aria-labelledby="integra-title">
    <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>
    <h3 id="integra-title" class="title-gradient">Sistemas que complementan tu Factura Electr√≥nica</h3>
    <div class="card body">
      <div class="carouselX" data-step="3">
        <button class="arrowCircle prev" aria-label="Anterior"><span class="chev">‚Äπ</span></button>
        <div class="track">
          <article class="sys"><img src="../IMG/contabilidad.webp" alt="Contabilidad" loading="lazy"/><h4>CONTPAQi Contabilidad</h4><p>Genera p√≥lizas de ingresos y asocia CFDI autom√°ticamente.</p></article>
          <article class="sys"><img src="../IMG/bancos.webp" alt="Bancos" loading="lazy"/><h4>CONTPAQi Bancos</h4><p>Concilia los cobros de tus facturas y genera p√≥lizas.</p></article>
          <article class="sys"><img src="../IMG/xml.webp" alt="XML en L√≠nea+" loading="lazy"/><h4>XML en L√≠nea+</h4><p>Descarga y administra tus CFDI emitidos y recibidos.</p></article>
          <article class="sys"><img src="../IMG/comercialstart.webp" alt="Comercial Start" loading="lazy"/><h4>Comercial Start</h4><p>Control b√°sico de inventarios y CxC.</p></article>
          <article class="sys"><img src="../IMG/cobra.webp" alt="Cobra" loading="lazy"/><h4>CONTPAQi Cobra</h4><p>Automatiza el env√≠o y seguimiento de cobranza.</p></article>
        </div>
        <button class="arrowCircle next" aria-label="Siguiente"><span class="chev">‚Ä∫</span></button>
        <div class="group-dots"></div>
      </div>
    </div>
  </section>

  <section id="calculadora-section" aria-labelledby="calc">
    <h3 id="calc" class="title-gradient">Conoce el precio de tu licencia</h3>
    <p class="hint" style="text-align:center">CONTPAQi Factura Electr√≥nica puede tener condiciones especiales por paquete.</p>
    <div class="calc-strip">
      <div id="app" data-system="CONTPAQi Factura Electr√≥nica" hidden></div>

      <div class="calc-row" id="calc-row">
        <div id="calc-primary" class="calc-container" aria-label="Calculadora principal"></div>

        <div id="calc-slot-2" class="placeholder">
          <div class="note">
            <strong>Integra Factura Electr√≥nica con otros sistemas CONTPAQi.</strong><br>
            <small>Selecciona un sistema para ver precios combinados.</small>
            <div class="icons-wrap" id="icons-sec-sys"></div>
          </div>
        </div>

        <div id="calc-tertiary" class="calc-container" aria-label="Tercera calculadora"></div>

        <div id="add-more-panel" class="placeholder" style="display:none">
          <div class="note">
            <strong>¬øAgregar un tercer sistema?</strong><br>
            <small>Calcula el precio total de tu paquete.</small>
            <div class="icons-wrap" id="icons-third-sys"></div>
          </div>
        </div>
      </div>

      <div id="combined-wrap" class="combined-card" hidden>
        <h4 class="title-gradient">Resumen combinado</h4>
        <table class="combined-table"><tbody id="combined-table-body"></tbody></table>
      </div>
    </div>
  </section>

  <section id="comparativa" aria-labelledby="comparativa-title">
    <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>
    <h3 id="comparativa-title" class="title-gradient">Comparativa con otras opciones</h3>
    <div class="card body">
      <table class="table-like">
        <thead><tr><th>Caracter√≠stica</th><th class="highlight">CONTPAQi Factura E.</th><th>Portal SAT Gratuito</th><th>Otras Herramientas Online</th><th>M√≥dulo ERP</th></tr></thead>
        <tbody>
          <tr><td>Timbrado Ilimitado</td><td class="highlight">‚úÖ Incluido</td><td>‚úÖ Incluido</td><td>‚ö†Ô∏è Puede tener costo/l√≠mite</td><td>‚úÖ Generalmente incluido</td></tr>
          <tr><td>Facilidad de Uso</td><td class="highlight">‚úÖ Muy Alta</td><td>‚ö†Ô∏è Media / Lenta</td><td>‚ö†Ô∏è Variable</td><td>‚ö†Ô∏è Puede ser complejo</td></tr>
          <tr><td>Carta Porte 3.1</td><td class="highlight">‚úÖ Simplificado</td><td>‚ö†Ô∏è Complejo / Manual</td><td>‚ö†Ô∏è Variable / Costo extra</td><td>‚ö†Ô∏è Variable / Costo extra</td></tr>
          <tr><td>Multi RFC</td><td class="highlight">‚úÖ Soportado</td><td>‚ùå No pr√°ctico</td><td>‚ö†Ô∏è Costo por RFC</td><td>‚ö†Ô∏è Costo por empresa</td></tr>
          <tr><td>Addendas y Complementos</td><td class="highlight">‚úÖ Amplia cobertura</td><td>‚ùå Limitado</td><td>‚ö†Ô∏è Variable / Costo extra</td><td>‚úÖ Generalmente cubre</td></tr>
          <tr><td>Integraci√≥n Contable</td><td class="highlight">‚úÖ Nativa (CONTPAQi)</td><td>‚ùå No aplica</td><td>‚ùå No / Layouts</td><td>‚úÖ Integrado</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <section id="faq" aria-labelledby="faq-title">
    <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>
    <h3 id="faq-title" class="title-gradient">Preguntas frecuentes</h3>
    <div class="faq-wrap" id="faqWrap">
      <details class="faq-item"><summary>¬øPuedo emitir facturas CFDI 4.0?</summary><p>S√≠, est√° actualizado para CFDI 4.0, REP 2.0, notas de cr√©dito y m√°s.</p></details>
      <details class="faq-item"><summary>¬øEl timbrado tiene costo extra?</summary><p>No, incluye <strong>timbrado ilimitado</strong> durante la vigencia.</p></details>
      <details class="faq-item"><summary>¬øEs f√°cil emitir Carta Porte 3.1?</summary><p>S√≠, cuenta con asistentes y cat√°logos que facilitan la captura requerida.</p></details>
      <details class="faq-item"><summary>¬øSirve para varios RFC?</summary><p>S√≠, es <strong>Multi RFC</strong>, ideal para contadores o grupos.</p></details>
      <details class="faq-item"><summary>¬øQu√© complementos/addendas soporta?</summary><p>INE, Notarios, Donatarias, Comercio Exterior, Hidrocarburos, y addendas de cadenas comerciales.</p></details>
    </div>
  </section>

  <section id="sesion-guiada" class="card body">
    <div class="lock-note">no borrar esta secci√≥n, no tocar, respetar y mantener integro</div>
    <h3 class="title-gradient">¬øListo para empezar?</h3>
    <p>Agenda una sesi√≥n con nuestros especialistas o tramita tu prueba sin costo.</p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
      <a class="btn btn-grad-blue" href="https://wa.me/5568437918?text=Hola%21%20Quiero%20agendar%20una%20sesi%C3%B3n%20guiada%20de%2045%20minutos%20por%20Zoom%20para%20Factura%20Electr%C3%B3nica" target="_blank" rel="noopener">Agendar sesi√≥n guiada (45 min)</a>
      <a class="btn btn-grad-green" href="https://wa.me/5568437918?text=Hola%20Expiriti%2C%20quiero%20comprar%20mi%20licencia%20de%20CONTPAQi%20Factura%20Electr%C3%B3nica" target="_blank" rel="noopener">Comprar ahora</a>
    </div>
  </section>

  <aside class="toc collapsed" id="toc">
    <button class="toc-toggle" id="tocToggle" aria-label="Abrir mapa">üó∫Ô∏è Mapa</button>
    <button class="toc-close" aria-label="Cerrar">√ó</button>
    <strong class="toc-title">Mapa del sitio</strong>
    <a href="#caracteristicas">Funcionalidades</a>
    <a href="#videos">V√≠deos</a>
    <a href="#integra">Sistemas integrables</a>
    <a href="#calculadora-section">Precio</a>
    <a href="#comparativa">Comparativa</a>
    <a href="#faq">Preguntas frecuentes</a>
    <a href="#sesion-guiada">Contacto</a>
  </aside>
</main>

<footer>
  <div class="container footer-grid">
    <div>
      <h3 class="footer-title">Contacto</h3>
      <div class="contact-list">
        <div class="item"><span class="ico">üìç</span><span><strong>Ubicaci√≥n:</strong> Insurgentes Sur 1188, CDMX</span></div>
        <div class="item"><span class="ico">‚òéÔ∏è</span><span><strong>Tel:</strong> <a href="tel:+525568437917">55 6843 7917</a> ¬∑ <a href="tel:+525568437918">55 6843 7918</a></span></div>
        <div class="item"><span class="ico">‚úâÔ∏è</span><span><strong>Mail:</strong> <a href="mailto:andree@expiriti.com.mx">andree@expiriti.com.mx</a></span></div>
      </div>
    </div>
    <div>
      <h3 class="footer-title">Formas de pago</h3>
      <div class="payments-grid"><img src="../IMG/pasarela-2.webp" alt="M√©todos de pago" loading="lazy"></div>
    </div>
    <div>
      <h3 class="footer-title">Marcas</h3>
      <div class="brands-col">
        <div class="brand-item"><img src="../IMG/CONTPAQi.webp" alt="CONTPAQi" loading="lazy"></div>
        <div class="brand-item"><img src="../IMG/Microsoft.webp" alt="Microsoft" loading="lazy"></div>
      </div>
    </div>
    <div class="ally-col">
      <h3 class="footer-title" style="justify-self:end">Aliados</h3>
      <img src="../IMG/bni.webp" alt="BNI" loading="lazy">
      <img src="../IMG/fucam.webp" alt="FUCAM" loading="lazy">
      <img src="../IMG/expiritilogo.webp" alt="Expiriti" loading="lazy">
    </div>
  </div>
  <div class="container footer-bottom">
    <div style="display:flex;align-items:center;gap:10px">
      <img src="../IMG/expiritilogo.webp" alt="Expiriti" style="width:34px;height:34px;border-radius:8px" loading="lazy">
      <div><strong>Expiriti</strong><div class="hint">¬© <span id="year"></span> ¬∑ Todos los derechos reservados</div></div>
    </div>
    <div class="hint">Aviso de privacidad ¬∑ T√©rminos</div>
  </div>
</footer>

<script>
// A√±o y men√∫ m√≥vil
document.getElementById('year').textContent=new Date().getFullYear();
document.getElementById('burger')?.addEventListener('click',()=>{document.getElementById('mobileMenu')?.classList.toggle('open');});

// TOC (Mapa)
(function(){
  const toc=document.getElementById('toc'), openBtn=document.getElementById('tocToggle'), closeBtn=toc?.querySelector('.toc-close');
  if(!toc||!openBtn||!closeBtn) return;
  openBtn.addEventListener('click',e=>{e.stopPropagation();toc.classList.toggle('collapsed');});
  closeBtn.addEventListener('click',()=>toc.classList.add('collapsed'));
  toc.querySelectorAll('a').forEach(a=>a.addEventListener('click',()=>toc.classList.add('collapsed')));
  document.addEventListener('click',e=>{if(!toc.contains(e.target) && e.target!==openBtn) toc.classList.add('collapsed');});
})();

// Galer√≠a portada
(function(){
  const root=document.getElementById('carousel1'); if(!root) return;
  const track=root.querySelector('.carousel-track'), dots=[...root.querySelectorAll('.dot')];
  const prev=root.querySelector('.arrowCircle.prev'), next=root.querySelector('.arrowCircle.next');
  let idx=0;
  function setActive(i){idx=(i+dots.length)%dots.length; dots.forEach((d,di)=>d.classList.toggle('active',di===idx)); track.scrollTo({left: track.clientWidth*idx, behavior:'smooth'});}  
  dots.forEach((d,i)=>d.addEventListener('click',()=>setActive(i)));
  prev.addEventListener('click',()=>setActive(idx-1));
  next.addEventListener('click',()=>setActive(idx+1));
  track.addEventListener('scroll',()=>{const i=Math.round(track.scrollLeft/track.clientWidth); dots.forEach((d,di)=>d.classList.toggle('active',di===i)); idx=i;});
  window.addEventListener('resize',()=>setActive(idx)); setActive(0);
})();

// Slider Beneficios
(function(){
  const wrap=document.querySelector('#beneficios .listSlider'); if(!wrap) return;
  const track=wrap.querySelector('.listTrack'), prev=wrap.querySelector('.prev'), next=wrap.querySelector('.next');
  let page=0, total=track.children.length;
  function go(i){page=(i+total)%total; track.scrollTo({left: wrap.clientWidth*page, behavior:'smooth'});}  
  prev.addEventListener('click',()=>go(page-1)); next.addEventListener('click',()=>go(page+1));
  window.addEventListener('resize',()=>go(page));
})();

// Carrusel sistemas integrables (corregido: 'dots' definido antes de usarse)
(function(){
  document.querySelectorAll('.carouselX').forEach(root=>{
    const track=root.querySelector('.track'),
          prev=root.querySelector('.arrowCircle.prev'),
          next=root.querySelector('.arrowCircle.next'),
          dotsWrap=root.querySelector('.group-dots');
    const items=[...track.querySelectorAll('.sys')];
    const itemsPerPage=3;

    const groupsCount=()=>Math.max(1, Math.ceil(items.length/itemsPerPage));
    const groupW=()=>track.clientWidth;

    // Mostrar controles s√≥lo si hace falta paginar
    const showControls = items.length > itemsPerPage;
    if (prev) prev.style.display = showControls ? '' : 'none';
    if (next) next.style.display = showControls ? '' : 'none';
    if (dotsWrap) dotsWrap.style.display = showControls ? '' : 'none';
    if (!showControls) return;

    dotsWrap.innerHTML='';
    const dots=Array.from({length:groupsCount()},(_,i)=>{
      const b=document.createElement('button');
      b.className='dot'+(i===0?' active':'');
      dotsWrap.appendChild(b);
      return b;
    });

    const setDot=(i)=>dots.forEach((d,idx)=>d.classList.toggle('active',idx===i));
    const goTo=(i)=>{ track.scrollTo({left:i*groupW(), behavior:'smooth'}); setDot(i); };

    let idx=0;
    dots.forEach((b,i)=>b.addEventListener('click',()=>{ idx=i; goTo(i); }));
    prev.addEventListener('click',()=>{ idx=Math.max(0,idx-1); goTo(idx); });
    next.addEventListener('click',()=>{ idx=Math.min(dots.length-1,idx+1); goTo(idx); });
    window.addEventListener('resize',()=>goTo(idx));
    goTo(0);
  });
})();

// P√≠ldoras (filtros)
(function(){
  const pills=[...document.querySelectorAll('.pill')];
  const cards=[...document.querySelectorAll('.feature-grid .fcard')];
  function apply(filter){
    cards.forEach(c=>{
      const show =
        (filter==='emision' && c.classList.contains('tag-emision')) ||
        (filter==='gestion' && c.classList.contains('tag-gestion')) ||
        (filter==='cumplimiento' && c.classList.contains('tag-cumplimiento'));
      c.style.display = show ? '' : 'none';
    });
  }
  pills.forEach(p=>{
    p.addEventListener('click',()=>{
      pills.forEach(x=>x.classList.remove('active'));
      p.classList.add('active');
      pills.forEach(x=>x.setAttribute('aria-pressed', x===p ? 'true':'false'));
      apply(p.dataset.filter);
    });
  });
  apply('emision');
})();

// ====== Calculadora ======
function hasPrices(systemName){return !!(window.preciosContpaqi && window.preciosContpaqi[systemName]);}

const CATALOG_SISTEMAS = [
  { name: "CONTPAQi Contabilidad", img: "../IMG/contabilidad.webp" },
  { name: "CONTPAQi Bancos", img: "../IMG/bancos.webp" },
  { name: "CONTPAQi N√≥minas", img: "../IMG/nominas.webp" },
  { name: "CONTPAQi XML en L√≠nea", img: "../IMG/xml.webp", noDiscount: true },
  { name: "CONTPAQi Comercial START", img: "../IMG/comercialstart.webp" },
  { name: "CONTPAQi Comercial PRO", img: "../IMG/comercialpro.webp" },
  { name: "CONTPAQi Comercial PREMIUM", img: "../IMG/comercialpremium.webp" }
];

function getPrecioDesde(systemName){
  const db = (window.preciosContpaqi && window.preciosContpaqi[systemName]) || null;
  if(!db) return null;
  if (db.anual?.MultiRFC?.precio_base || db.anual?.MultiRFC?.renovacion)
    return Number(db.anual.MultiRFC.precio_base || db.anual.MultiRFC.renovacion || 0);
  if (db.anual?.MonoRFC?.precio_base || db.anual?.MonoRFC?.renovacion)
    return Number(db.anual.MonoRFC.precio_base || db.anual.MonoRFC.renovacion || 0);
  return null;
}
const moneyMX = new Intl.NumberFormat("es-MX", { style:"currency", currency:"MXN", maximumFractionDigits:0 });

const selected = { secondary: null, tertiary: null };
const selectedSet=()=>new Set([selected.secondary, selected.tertiary].filter(Boolean));

function renderSistemasPicker(containerId, exclude = new Set(), activeName = null){
  const wrap = document.getElementById(containerId);
  if(!wrap) return;
  wrap.innerHTML = "";
  const primarySys = document.getElementById('app')?.dataset?.system;
  if (primarySys) exclude.add(primarySys);

  CATALOG_SISTEMAS.forEach(item=>{
    if (exclude.has(item.name)) return;
    const precio = getPrecioDesde(item.name);
    const btn = document.createElement("button");
    btn.className = "sys-icon";
    btn.type = "button";
    btn.dataset.sys = item.name;
    btn.title = item.name;
    btn.innerHTML = `
      ${item.noDiscount ? '<small class="sin15">sin -15%</small>' : ''}
      <img src="${item.img}" alt="${item.name}">
      <strong>${item.name.replace('CONTPAQi ','')}</strong>
      <small class="sys-price">${precio != null ? 'desde '+moneyMX.format(precio) : 'precio no disp.'}</small>
    `;
    if (activeName && activeName === item.name) btn.classList.add('active');
    wrap.appendChild(btn);
  });
}

function renderCombinedTable(rows){
  const wrap=document.getElementById('combined-wrap');
  const tbody=document.getElementById('combined-table-body');
  if(!wrap||!tbody) return;
  tbody.innerHTML='';
  rows.forEach(([concepto, importe])=>{
    const tr=document.createElement('tr');
    const td1=document.createElement('td'); td1.textContent=concepto;
    const td2=document.createElement('td'); td2.textContent=importe; td2.style.textAlign='right';
    tr.appendChild(td1); tr.appendChild(td2); tbody.appendChild(tr);
  });
  wrap.hidden=false;
}

document.addEventListener("DOMContentLoaded", ()=>{
  const row=document.getElementById('calc-row'),
        slot2=document.getElementById('calc-slot-2'),
        slot3=document.getElementById('calc-tertiary'),
        addMore=document.getElementById('add-more-panel');
  const pick2=document.getElementById('icons-sec-sys'),
        pick3=document.getElementById('icons-third-sys');
  const primarySystem = document.getElementById('app')?.dataset?.system;

  const initialExclude = new Set(primarySystem ? [primarySystem] : []);
  renderSistemasPicker("icons-sec-sys", initialExclude);
  renderSistemasPicker("icons-third-sys", initialExclude);

  function refreshPickers(){
    const ex = selectedSet();
    if (primarySystem) ex.add(primarySystem);
    renderSistemasPicker("icons-sec-sys", ex, selected.secondary);
    renderSistemasPicker("icons-third-sys", ex, selected.tertiary);
  }
  function showAddMoreIfReady(){
    if(addMore) addMore.style.display = selected.secondary ? '' : 'none';
  }

  // Secundaria
  pick2?.addEventListener('click', e=>{
    const btn=e.target.closest('.sys-icon'); if(!btn) return;
    const sys=btn.dataset.sys; if(!hasPrices(sys)) return;
    selected.secondary = sys;
    selected.tertiary  = selected.tertiary === sys ? null : selected.tertiary;
    slot2.className='calc-container'; slot2.id='calc-secondary';
    if (window.CalculadoraContpaqi) {
      CalculadoraContpaqi.setSecondarySystem(sys,{
        secondarySelector:'#calc-secondary',
        combinedSelector:'#combined-wrap',
        onCombined:renderCombinedTable
      });
    }
    refreshPickers();
    showAddMoreIfReady();
  });

  // Terciaria
  pick3?.addEventListener('click', e=>{
    const btn=e.target.closest('.sys-icon'); if(!btn) return;
    const sys=btn.dataset.sys; if(!hasPrices(sys)) return;
    if (sys === selected.secondary) return;
    selected.tertiary = sys;
    slot3.style.display='block';
    if (window.CalculadoraContpaqi) {
      CalculadoraContpaqi.setTertiarySystem(sys,{
        tertiarySelector:'#calc-tertiary',
        combinedSelector:'#combined-wrap',
        onCombined:renderCombinedTable
      });
    }
    if(addMore) addMore.style.display='none';
    row.classList.add('has-three');
    refreshPickers();
  });

  // Primaria
  if(!window.CalculadoraContpaqi){
    console.error('‚ùå calculadora.js no carg√≥. Verifica ruta.');
  }else{
    const sys=primarySystem;
    if(sys){
      window.CalculadoraContpaqi.init({
        systemName: sys,
        primarySelector:'#calc-primary',
        combinedSelector:'#combined-wrap'
      });
    }
  }
});
</script>

<script defer src="../precios-contpaqi.js?v=3"></script>
<script defer src="../calculadora.js?v=13"></script>
</body>
</html>

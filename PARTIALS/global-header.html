<!-- /PARTIALS/global-header.html -->
<header class="gh" role="banner">
<style>
/* =========================================================
   Expiriti — Global Header (MEGA MENU FIXED + HOVER INTENT)
   - Mega menú "Sistemas" NO genera scroll horizontal
   - Menús NO se cierran tan fácil (mouse/trackpad)
   ========================================================= */

/* === BASE HEADER === */
.gh{
  position:sticky; top:0; z-index:999;
  backdrop-filter:blur(18px);
  -webkit-backdrop-filter:blur(18px);
  background:rgba(7,10,16,.92);
  border-bottom:1px solid rgba(255,255,255,.06);
}
.gh-container{
  max-width:var(--maxw,1200px);
  margin:0 auto;
  padding:12px 18px;
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:14px;
  align-items:center;
}
.gh-brand{
  display:flex; align-items:center; gap:10px;
  text-decoration:none; color:var(--text,#e8eef6);
  padding:4px 6px; border-radius:999px;
  transition:.22s ease;
}
.gh-brand:hover{ background:rgba(255,255,255,.04); transform:translateY(-1px) }
.gh-brand img{ width:44px; height:44px; border-radius:12px; flex:0 0 44px }
.gh-brand-title{ display:flex; flex-direction:column; line-height:1.1; white-space:nowrap }
.gh-brand-title .name{ font-size:16px; font-weight:600; letter-spacing:.02em; color:#fff }
.gh-brand-title .sub{ font-size:13px; color:var(--muted,#95a2b3) }

/* === NAV === */
.gh-nav{ justify-self:center }
.gh-nav>ul{
  display:flex; gap:18px; list-style:none;
  margin:0; padding:0; align-items:center;
}
.gh-nav>ul>li{ display:flex; align-items:center; position:relative }

/* Links top */
.gh-nav a{
  position:relative;
  color:var(--text,#e8eef6);
  text-decoration:none;
  font-weight:500;
  font-size:14px;
  padding:6px 2px;
  line-height:1;
  transition:color .2s ease;
}
.gh-nav a::after{
  content:"";
  position:absolute; left:0; right:0; bottom:-4px;
  height:2px; border-radius:999px;
  background:linear-gradient(90deg,var(--brand,#2dd4bf),var(--brand-2,#60a5fa));
  transform:scaleX(0); transform-origin:center;
  transition:.22s ease; opacity:0;
}
.gh-nav a:hover::after{ transform:scaleX(1); opacity:1 }
.gh-nav a.active-parent{ color:var(--brand,#2dd4bf) }
.gh-nav a.active-parent::after{ transform:scaleX(1); opacity:1 }

/* === DROPDOWNS (base) === */
.gh-has-dd{ position:relative }

/* Dropdown panel base */
.gh-dd{
  position:absolute;
  top:calc(100% + 8px);              /* menos gap = menos “se corta” al bajar */
  background:rgba(10,14,23,.98);
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 18px 45px rgba(0,0,0,.6);
  border-radius:18px;
  min-width:240px;
  padding:14px;
  display:none;
  z-index:1000;
}

/* “Puente” invisible para que NO se cierre al cruzar el gap */
.gh-has-dd::after{
  content:"";
  position:absolute;
  left:-14px; right:-14px;
  top:100%;
  height:14px;
}

/* Abierto por clase (JS) + fallback hover/focus */
.gh-has-dd.open > .gh-dd{ display:block }
.gh-has-dd:focus-within > .gh-dd{ display:block }
@media (hover:hover){
  .gh-has-dd:hover > .gh-dd{ display:block }
}

/* === MEGA MENU (Sistemas) — FIXED (no scroll horizontal) === */
.gh-dd.mega{
  position:fixed;                    /* clave: relativo al viewport */
  left:50%;
  transform:translateX(-50%);
  top:calc(var(--ghh,64px) + 10px);  /* JS setea --ghh con la altura real del header */
  width:min(980px, calc(100vw - 24px));
  max-width:calc(100vw - 24px);
  padding:24px;
  box-sizing:border-box;
}

.gh-mega{
  display:grid;
  grid-template-columns:repeat(4, 1fr);
  gap:20px;
}

/* Columnas */
.gh-col{
  border-radius:16px;
  padding:12px;
  background:radial-gradient(circle at top left,rgba(255,255,255,.03),transparent 55%);
  border:1px solid rgba(255,255,255,.06);
  min-width:0; /* importante para que no empuje */
}
.gh-col h4{
  margin:0 0 8px;
  font-size:12px;
  letter-spacing:.14em;
  color:var(--muted);
  text-transform:uppercase;
  opacity:.7;
}
.gh-subhead{
  display:flex; align-items:center; gap:6px;
  margin:12px 0 8px;
  font-weight:600;
  font-size:11px;
  color:#fff;
  text-transform:uppercase;
  letter-spacing:.05em;
}
.gh-subhead svg{ width:14px; height:14px; opacity:.9; color:var(--brand,#2dd4bf) }

.gh-col ul{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:6px }

/* Link tarjeta */
.gh-col a.gh-link{
  display:flex;
  align-items:center;
  gap:14px;
  padding:10px 12px;
  border-radius:12px;
  text-decoration:none;
  color:var(--text);
  border:1px solid transparent;
  transition:.2s ease;
  min-width:0; /* evitar overflow */
}
.gh-col a.gh-link:hover{
  background:rgba(255,255,255,.05);
  border-color:rgba(255,255,255,.1);
}

/* Iconos sistemas (grandes, sin romper texto) */
.gh-ico32{
  width:56px;
  height:56px;
  object-fit:contain;
  display:block;
  flex:0 0 56px;
}
@media (min-width:1200px){
  .gh-ico32{ width:64px; height:64px; flex-basis:64px }
}

/* Texto */
.gh-link-content{ display:flex; flex-direction:column; gap:2px; min-width:0 }
.gh-link strong{ font-size:13px; font-weight:600; color:#fff; line-height:1.1 }
.gh-desc{
  margin:0;
  font-size:11px;
  line-height:1.3;
  color:var(--muted,#94a3b8);
  display:block;
  white-space:normal;  /* que sí se vea el texto */
  overflow:visible;
}

/* === Servicios dropdown (lista) === */
.gh-list{ display:flex; flex-direction:column; gap:6px; min-width:260px }
.gh-list a{
  display:flex; gap:10px; align-items:center;
  padding:10px 12px;
  border-radius:12px;
  color:var(--text);
  text-decoration:none;
  background:rgba(17,23,35,.5);
  border:1px solid rgba(255,255,255,.06);
  font-size:13px;
  transition:.22s ease;
}
.gh-list a:hover{
  border-color:rgba(255,255,255,.18);
  background:rgba(27,33,48,1);
  transform:translateY(-1px);
}
.gh-ico{ width:18px; height:18px; opacity:.9 }

/* CTA */
.gh-cta{ display:flex; gap:8px; align-items:center }
.gh-btn{
  border:1px solid rgba(255,255,255,.22);
  background:rgba(15,23,42,.9);
  color:var(--text);
  padding:8px 14px;
  border-radius:999px;
  text-decoration:none;
  font-size:13px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  transition:.2s ease;
}
.gh-btn:hover{
  background:linear-gradient(90deg,var(--brand,#2dd4bf),var(--brand-2,#60a5fa));
  color:#020617;
  border-color:transparent;
  transform:translateY(-1px);
}
.gh-burger{
  display:none;
  border:1px solid rgba(255,255,255,.22);
  background:rgba(15,23,42,.9);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  font-size:18px;
}

/* Subnav */
.gh-subnav{ display:none; border-top:1px solid rgba(255,255,255,.06); background:rgba(5,8,14,.96) }
.gh-subinner{ max-width:var(--maxw,1200px); margin:0 auto; padding:8px 18px; display:flex; gap:8px; flex-wrap:wrap }

/* Responsive mega: 2 columnas */
@media (max-width:1100px){
  .gh-mega{ grid-template-columns:repeat(2, 1fr) }
}

/* Mobile header */
@media (max-width:980px){
  .gh-container{ grid-template-columns:1fr auto; gap:8px }
  .gh-nav{ display:none }
  .gh-burger{ display:inline-flex }
  .gh-cta .gh-btn:first-child{ display:none }
}
</style>

  <div class="gh-container">
    <a class="gh-brand js-abs-href" data-href="index.html" aria-label="Inicio Expiriti">
      <img class="js-abs-src" src="IMG/expiritilogo.webp" data-src="IMG/expiritilogo.webp" alt="Expiriti">
      <div class="gh-brand-title">
        <span class="name">Expiriti</span>
        <span class="sub">Distribuidor CONTPAQi</span>
      </div>
    </a>

    <nav class="gh-nav" aria-label="Principal">
      <ul>
        <li><a class="js-abs-href" data-href="index.html">Inicio</a></li>

        <!-- SISTEMAS -->
        <li class="gh-has-dd" data-dd="sistemas">
          <a class="js-abs-href" data-href="index.html#productos" aria-haspopup="true" aria-expanded="false">Sistemas</a>

          <div class="gh-dd mega" role="menu" aria-label="Sistemas">
            <div class="gh-mega">

              <div class="gh-col">
                <h4>Procesos contables</h4>
                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="5" width="18" height="12" rx="2"/><path d="M9 19h6"/></svg>
                  Desktop
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/contabilidad.html"><img class="gh-ico32 js-abs-src" data-src="IMG/contabilidad.webp" alt=""><div class="gh-link-content"><strong>Contabilidad</strong><span class="gh-desc">Pólizas, IVA y contabilidad electrónica.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/nominas.html"><img class="gh-ico32 js-abs-src" data-src="IMG/nominas.webp" alt=""><div class="gh-link-content"><strong>Nóminas</strong><span class="gh-desc">Cálculo de nómina y timbrado.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/bancos.html"><img class="gh-ico32 js-abs-src" data-src="IMG/bancos.webp" alt=""><div class="gh-link-content"><strong>Bancos</strong><span class="gh-desc">Flujo de efectivo y tesorería.</span></div></a></li>
                </ul>

                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 14a5 5 0 0 1 9.7-1.5A4 4 0 1 1 17 19H8a4 4 0 0 1-1-7.85"/></svg>
                  Nube
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/contabiliza.html"><img class="gh-ico32 js-abs-src" data-src="IMG/contabiliza.webp" alt=""><div class="gh-link-content"><strong>Contabiliza</strong><span class="gh-desc">Contabilidad nube.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/personia.html"><img class="gh-ico32 js-abs-src" data-src="IMG/personia.webp" alt=""><div class="gh-link-content"><strong>Personia</strong><span class="gh-desc">Nómina nube.</span></div></a></li>
                </ul>
              </div>

              <div class="gh-col">
                <h4>Procesos comerciales</h4>
                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="5" width="18" height="12" rx="2"/><path d="M9 19h6"/></svg>
                  Desktop
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/comercialpremium.html"><img class="gh-ico32 js-abs-src" data-src="IMG/comercialpremium.webp" alt=""><div class="gh-link-content"><strong>Comercial Premium</strong><span class="gh-desc">Inventarios y series.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/comercialpro.html"><img class="gh-ico32 js-abs-src" data-src="IMG/comercialpro.webp" alt=""><div class="gh-link-content"><strong>Comercial Pro</strong><span class="gh-desc">Alto volumen.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/facturaelectronica.html"><img class="gh-ico32 js-abs-src" data-src="IMG/factura.webp" alt=""><div class="gh-link-content"><strong>Factura Electrónica</strong><span class="gh-desc">Facturación servicios.</span></div></a></li>
                </ul>

                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 14a5 5 0 0 1 9.7-1.5A4 4 0 1 1 17 19H8a4 4 0 0 1-1-7.85"/></svg>
                  Nube
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/vende.html"><img class="gh-ico32 js-abs-src" data-src="IMG/vende.webp" alt=""><div class="gh-link-content"><strong>Vende</strong><span class="gh-desc">Facturación nube.</span></div></a></li>
                </ul>
              </div>

              <div class="gh-col">
                <h4>Productividad</h4>
                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 14a5 5 0 0 1 9.7-1.5A4 4 0 1 1 17 19H8a4 4 0 0 1-1-7.85"/></svg>
                  Nube
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/kursa.html"><img class="gh-ico32 js-abs-src" data-src="IMG/kursa.webp" alt=""><div class="gh-link-content"><strong>Kursa</strong><span class="gh-desc">Cursos y capacitación.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/evalua.html"><img class="gh-ico32 js-abs-src" data-src="IMG/evalua.webp" alt=""><div class="gh-link-content"><strong>Evalúa</strong><span class="gh-desc">NOM 035.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/colabora.html"><img class="gh-ico32 js-abs-src" data-src="IMG/colabora.webp" alt=""><div class="gh-link-content"><strong>Colabora</strong><span class="gh-desc">App empleados.</span></div></a></li>
                </ul>

                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="5" width="18" height="12" rx="2"/><path d="M9 19h6"/></svg>
                  Promociones
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="index.html#promociones"><img class="gh-ico32 js-abs-src" data-src="IMG/promo.webp" alt=""><div class="gh-link-content"><strong>Promociones</strong><span class="gh-desc">Ver descuentos activos.</span></div></a></li>
                </ul>
              </div>

              <div class="gh-col">
                <h4>Infraestructura</h4>
                <div class="gh-subhead">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 14a5 5 0 0 1 9.7-1.5A4 4 0 1 1 17 19H8a4 4 0 0 1-1-7.85"/></svg>
                  Servicios Nube
                </div>
                <ul>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/respaldo.html"><img class="gh-ico32 js-abs-src" data-src="IMG/respaldos.webp" alt=""><div class="gh-link-content"><strong>Respaldos</strong><span class="gh-desc">Nube automática.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/escritorio-virtual.html"><img class="gh-ico32 js-abs-src" data-src="IMG/escritorio-virtual.webp" alt=""><div class="gh-link-content"><strong>Escritorio Virtual</strong><span class="gh-desc">Tu oficina remota.</span></div></a></li>
                  <li><a class="gh-link js-abs-href" data-href="SISTEMAS/timbra.html"><img class="gh-ico32 js-abs-src" data-src="IMG/timbra.webp" alt=""><div class="gh-link-content"><strong>Timbra</strong><span class="gh-desc">Timbrado masivo.</span></div></a></li>
                </ul>
              </div>

            </div>
          </div>
        </li>

        <!-- SERVICIOS -->
        <li class="gh-has-dd" data-dd="servicios">
          <a class="js-abs-href" data-href="index.html#servicios" aria-haspopup="true" aria-expanded="false">Servicios</a>
          <div class="gh-dd" role="menu" aria-label="Servicios">
            <div class="gh-list" role="group">
              <a class="js-abs-href" data-href="SERVICIOS/cursos.html"><svg class="gh-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19h16M8 5h8v10H8z"/></svg>Cursos</a>
              <a class="js-abs-href" data-href="SERVICIOS/implementaciones.html"><svg class="gh-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3v18M3 12h18"/></svg>Implementaciones</a>
              <a class="js-abs-href" data-href="SERVICIOS/migraciones.html"><svg class="gh-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12h16M12 4l8 8-8 8"/></svg>Migraciones</a>
              <a class="js-abs-href" data-href="SERVICIOS/servidoresvirtuales.html"><svg class="gh-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 7h10v10H7z"/></svg>Servidores virtuales</a>
              <a class="js-abs-href" data-href="SERVICIOS/soporte.html"><svg class="gh-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 6a6 6 0 0 0-6 6v4h12v-4a6 6 0 0 0-6-6z"/></svg>Soporte técnico</a>
              <a class="js-abs-href" data-href="SERVICIOS/desarrollos.html"><svg class="gh-ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 8l-4 4 4 4M16 8l4 4-4 4"/></svg>Desarrollos a la medida</a>
            </div>
          </div>
        </li>

        <!-- Links a secciones del index -->
        <li><a class="js-abs-href" data-href="index.html#promociones">Promociones</a></li>
        <li><a class="js-abs-href" data-href="index.html#productos-con">Eventos</a></li>
        <li><a class="js-abs-href" data-href="nosotros.html">Nosotros</a></li>
        <li><a class="js-abs-href" data-href="index.html#contacto">Contacto</a></li>
      </ul>
    </nav>

    <div class="gh-cta">
      <a class="gh-btn" href="tel:+525568437918">55 6843 7918</a>
      <a class="gh-btn" href="https://wa.me/5568437918?text=Hola%20Expiriti%2C%20quiero%20informaci%C3%B3n" target="_blank" rel="noopener">WhatsApp</a>
      <button class="gh-burger" id="gh-burger" aria-label="Abrir menú">≡</button>
    </div>
  </div>

  <div class="gh-subnav" id="gh-subnav" aria-label="Accesos rápidos">
    <div class="gh-subinner" id="gh-subinner"></div>
  </div>

<script>
/* =========================================================
   Header JS
   - Rutas absolutas GH Pages + local
   - Hover intent (delay) para que NO se cierre fácil
   - Click-outside + Escape
   - Ajusta --ghh para top del mega fixed
   ========================================================= */
(() => {
  const $  = (s, c=document) => c.querySelector(s);
  const $$ = (s, c=document) => Array.from(c.querySelectorAll(s));

  const isGh = location.hostname.endsWith("github.io");
  const firstSeg = location.pathname.split("/")[1] || "";
  const repoBase = (isGh && firstSeg) ? ("/" + firstSeg) : "";

  function prefix(p){
    if (!p) return "#";
    if (/^https?:\/\//i.test(p)) return p;
    if (p.startsWith("mailto:") || p.startsWith("tel:")) return p;
    if (p.startsWith("#")) return p;
    // siempre raíz del repo en GH, y relativo en local
    return (isGh ? (repoBase + "/" + p) : ("../".repeat((location.pathname.match(/\//g)||[]).length-2) + p))
      .replace(/\/+/g,"/");
  }

  // Fix href/src desde data-*
  $$(".js-abs-href[data-href]").forEach(a => {
    const raw = a.getAttribute("data-href") || "";
    const [path, hash] = raw.split("#");
    a.href = prefix(path) + (hash ? ("#" + hash) : "");
  });
  $$(".js-abs-src[data-src]").forEach(img => {
    img.src = prefix(img.getAttribute("data-src"));
  });

  // Set --ghh (altura real del header)
  const header = $(".gh");
  function setHeaderH(){
    const h = header ? header.getBoundingClientRect().height : 64;
    document.documentElement.style.setProperty("--ghh", Math.round(h) + "px");
  }
  setHeaderH();
  window.addEventListener("resize", setHeaderH);
  window.addEventListener("load", setHeaderH);

  // Active parent
  const path = window.location.pathname.toLowerCase();
  const topLinks = $$(".gh-nav > ul > li > a");
  topLinks.forEach(a => {
    a.classList.remove("active-parent");
    const t = (a.textContent || "").trim().toLowerCase();
    if (t === "sistemas" && path.includes("/sistemas/")) a.classList.add("active-parent");
    else if (t === "servicios" && path.includes("/servicios/")) a.classList.add("active-parent");
    else if (t === "nosotros" && path.includes("nosotros")) a.classList.add("active-parent");
    else if (t === "contacto" && path.includes("contacto")) a.classList.add("active-parent");
    else if (t === "promociones" && path.includes("promociones")) a.classList.add("active-parent");
    else if (t === "eventos" && path.includes("eventos")) a.classList.add("active-parent");
    else if (t === "inicio" && (path.endsWith("index.html") || path.endsWith("/"))) a.classList.add("active-parent");
  });

  // ---------------------------------------------------------
  // Hover intent dropdowns (evita que se cierre fácil)
  // ---------------------------------------------------------
  const ddItems = $$(".gh-has-dd");
  let openItem = null;
  let closeTimer = null;

  const OPEN_DELAY  = 0;     // ms
  const CLOSE_DELAY = 350;   // ms (clave para trackpad)

  function closeAll(){
    ddItems.forEach(li => li.classList.remove("open"));
    openItem = null;
    ddItems.forEach(li => {
      const a = $("a", li);
      if (a) a.setAttribute("aria-expanded","false");
    });
  }

  function open(li){
    if (!li) return;
    if (closeTimer) { clearTimeout(closeTimer); closeTimer = null; }
    if (openItem && openItem !== li) openItem.classList.remove("open");
    li.classList.add("open");
    openItem = li;
    const a = $("a", li);
    if (a) a.setAttribute("aria-expanded","true");
    setHeaderH();
  }

  function scheduleClose(){
    if (closeTimer) clearTimeout(closeTimer);
    closeTimer = setTimeout(() => {
      closeAll();
    }, CLOSE_DELAY);
  }

  // Mouse/trackpad: enter/leave con delay
  ddItems.forEach(li => {
    li.addEventListener("pointerenter", () => {
      if (window.matchMedia("(hover:hover)").matches){
        setTimeout(() => open(li), OPEN_DELAY);
      }
    });
    li.addEventListener("pointerleave", () => {
      if (window.matchMedia("(hover:hover)").matches){
        scheduleClose();
      }
    });

    // Touch / click: toggle
    const a = $("a", li);
    if (a){
      a.addEventListener("click", (ev) => {
        // En desktop hover, dejamos que funcione hover normal,
        // pero si el usuario da click, togglear ayuda a trackpad.
        if (li.classList.contains("open")){
          // si ya está abierto y hace click, NO navegues; solo mantén abierto
          ev.preventDefault();
        } else {
          // abrir sin navegar al primer click
          ev.preventDefault();
          open(li);
        }
      });
    }

    // Si el cursor está dentro del panel, cancelamos el cierre
    const panel = $(".gh-dd", li);
    panel && panel.addEventListener("pointerenter", () => {
      if (closeTimer) { clearTimeout(closeTimer); closeTimer = null; }
    });
    panel && panel.addEventListener("pointerleave", () => {
      if (window.matchMedia("(hover:hover)").matches) scheduleClose();
    });
  });

  // Click fuera cierra
  document.addEventListener("click", (ev) => {
    const t = ev.target;
    if (openItem && t && !openItem.contains(t)){
      closeAll();
    }
  });

  // Escape cierra
  document.addEventListener("keydown", (ev) => {
    if (ev.key === "Escape") closeAll();
  });

  // Acceso teclado: ArrowDown
  $$(".gh-has-dd > a").forEach(a => {
    a.addEventListener("keydown", (ev) => {
      if (ev.key === "ArrowDown"){
        ev.preventDefault();
        const li = a.closest(".gh-has-dd");
        open(li);
        const panel = li ? $(".gh-dd", li) : null;
        panel && panel.querySelector("a,button,[tabindex]")?.focus?.();
      }
    });
  });

  // Subnav (solo si existen anclas)
  const subnav = $("#gh-subnav");
  const subinner = $("#gh-subinner");
  const links = [
    ["#caracteristicas","Funcionalidades"],
    ["#videos","Vídeos"],
    ["#integra","Integraciones"],
    ["#calculadora-section","Precio"],
    ["#comparativa","Comparativa"],
    ["#faq","Preguntas frecuentes"],
    ["#sesion-guiada","Demo"]
  ].filter(([sel]) => document.querySelector(sel));

  if (links.length && subnav && subinner){
    subnav.style.display = "block";
    subinner.innerHTML = links.map(([href, label]) => `<a href="${href}">${label}</a>`).join("");
  }
})();
</script>
</header>

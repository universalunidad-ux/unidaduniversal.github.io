'use strict';const $=(s,c=document)=>c.querySelector(s);const $$=(s,c=document)=>Array.from(c.querySelectorAll(s));async function loadPartial(id,url){const r=document.getElementById(id);if(!r)return;try{const res=await fetch(url);if(!res.ok)return;r.innerHTML=await res.text()}catch(e){console.error('Error cargando parcial',id,e)}}function initPartials(){loadPartial('header-placeholder','PARTIALS/global-header.html');loadPartial('footer-placeholder','PARTIALS/global-footer.html')}function initClickableCards(){$$('.product-card[data-href]').forEach(card=>{const h=card.dataset.href;if(!h)return;card.style.cursor='pointer';card.addEventListener('click',e=>{if(e.target.closest('a'))return;window.location.href=h})})}function initProductTabs(){const tabs=$$('.prod-tabs .tab');const panels=$$('.panel-productos');if(!tabs.length||!panels.length)return;function activarTabProductos(btn){const id=btn.dataset.target;if(!id)return;tabs.forEach(t=>t.classList.toggle('active',t===btn));panels.forEach(p=>{const show=p.id===id;p.classList.toggle('hidden',!show);p.setAttribute('aria-hidden',show?'false':'true')})}tabs.forEach(b=>b.addEventListener('click',()=>activarTabProductos(b)));const ini=document.getElementById('tab-contable')||tabs[0];if(ini)activarTabProductos(ini)}function initPromoFilters(){const btns=$$('.promo-btn');const promos=$$('#promoGrid [data-type]');if(!btns.length||!promos.length)return;function setPromoFilter(type){btns.forEach(b=>b.classList.toggle('active',b.dataset.filter===type));promos.forEach(img=>{img.style.display=img.dataset.type===type?'':'none'})}btns.forEach(b=>b.addEventListener('click',()=>setPromoFilter(b.dataset.filter)));const active=btns.find(b=>b.classList.contains('active'))||btns[0];if(active)setPromoFilter(active.dataset.filter)}function initContactForm(){const f=document.getElementById('contactForm');if(!f)return;f.addEventListener('submit',e=>{e.preventDefault();const nombre=f.nombre?.value?.trim()||'';const correo=f.correo?.value?.trim()||'';const tel=f.telefono?.value?.trim()||'';const interes=f.interes?.value||'';const detalle=f.detalle?.value?.trim()||'';const lineas=['Hola, vengo de la página de Expiriti.',nombre&&`Nombre: ${nombre}`,correo&&`Correo: ${correo}`,tel&&`Teléfono / WhatsApp: ${tel}`,interes&&`Interesado en: ${interes}`,detalle&&'',detalle].filter(Boolean);const texto=encodeURIComponent(lineas.join('\n'));const url=`https://wa.me/525568437918?text=${texto}`;window.open(url,'_blank')})}function pauseAllYouTubeVideos(){const frames=document.querySelectorAll('iframe[src*="youtube.com/embed"], iframe[src*="youtube-nocookie.com/embed"]');frames.forEach(f=>{try{f.contentWindow.postMessage(JSON.stringify({event:'command',func:'pauseVideo',args:''}),'*')}catch(e){}})}function enhanceLiteEmbeds(root=document){const blocks=$$('.yt-lite[data-ytid]:not([data-yt-ready="1"])',root);if(!blocks.length)return;blocks.forEach(b=>{const vid=b.dataset.ytid;if(!vid)return;const title=b.dataset.title||'Reproducir video';const thumb=`https://i.ytimg.com/vi/${vid}/hqdefault.jpg`;b.innerHTML=`<button class="yt-lite-inner" type="button" aria-label="${title}"><span class="yt-lite-thumb" style="background-image:url('${thumb}')"></span><span class="yt-lite-play"></span></button>`;b.dataset.ytReady='1';b.addEventListener('click',()=>{if(b.dataset.ytLoaded==='1')return;pauseAllYouTubeVideos();const src=`https://www.youtube-nocookie.com/embed/${vid}?autoplay=1&rel=0&modestbranding=1&enablejsapi=1`;b.innerHTML=`<iframe class="yt-iframe" src="${src}" title="${title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>`;b.dataset.ytLoaded='1'})})}const REELS_DATA={contable:{contabilidad:[{id:'wy6jeLYnubM',title:'Contabilidad y Contabiliza te ayudan en la DIOT'}],nominas:[{id:'FDOKmJolVTM',title:'Tips para nómina sin errores'}],bancos:[{id:'FDOKmJolVTM',title:'Conciliación bancaria más rápida'}],xml:[{id:'wy6jeLYnubM',title:'Control de CFDI con XML en Línea+'}]},comercial:{start:[{id:'FDOKmJolVTM',title:'Arranca ventas con Comercial Start'}],pro:[{id:'wy6jeLYnubM',title:'Control de inventarios con Comercial Pro'}],premium:[{id:'FDOKmJolVTM',title:'Comercial Premium para empresas en crecimiento'}],factura:[{id:'wy6jeLYnubM',title:'Factura electrónica fácil y rápida'}]},nube:{analiza:[{id:'wy6jeLYnubM',title:'Analiza: BI para tus sistemas CONTPAQi'}],contabiliza:[{id:'FDOKmJolVTM',title:'Contabiliza: contabilidad en la nube'}],despachos:[{id:'wy6jeLYnubM',title:'Despachos: controla tus clientes en la nube'}],vende:[{id:'FDOKmJolVTM',title:'Vende: punto de venta conectado'}]},productividad:{evalua:[{id:'wy6jeLYnubM',title:'Evalúa clima laboral y NOM-035'}],colabora:[{id:'FDOKmJolVTM',title:'Colabora: seguimiento desde tu móvil'}],personia:[{id:'wy6jeLYnubM',title:'Personia: expedientes digitales en la nube'}]},servicios:{implementaciones:[{id:'wy6jeLYnubM',title:'Implementaciones CONTPAQi con Expiriti'}],migraciones:[{id:'FDOKmJolVTM',title:'Migraciones desde otros sistemas'}],desarrollos:[{id:'wy6jeLYnubM',title:'Desarrollos y automatizaciones a la medida'}],servidores:[{id:'FDOKmJolVTM',title:'Servidores virtuales para tus sistemas'}],cursos:[{id:'wy6jeLYnubM',title:'Cursos por sistema CONTPAQi'}],soporte:[{id:'FDOKmJolVTM',title:'Soporte técnico remoto y pólizas'}]}};const reelsState={};function setReelSystem(panel,sys){const dataPanel=REELS_DATA[panel]||{};const videos=dataPanel[sys]||[];const carousel=document.getElementById(`carouselReels-${panel}`);const titleEl=document.getElementById(`reelTitle-${panel}`);if(!carousel)return;const track=$('.carousel-track',carousel);const nav=$('.carousel-nav',carousel);if(!track||!nav)return;pauseAllYouTubeVideos();track.innerHTML='';nav.innerHTML='';videos.forEach((v,idx)=>{const slide=document.createElement('div');slide.className='reel-slide';slide.dataset.index=String(idx);slide.innerHTML=`<div class="yt-lite" data-ytid="${v.id}" data-title="${v.title||''}"></div>`;track.appendChild(slide);const dot=document.createElement('button');dot.type='button';dot.className='dot';dot.setAttribute('aria-label',`Video ${idx+1}`);dot.addEventListener('click',()=>goToReelSlide(panel,idx));nav.appendChild(dot)});enhanceLiteEmbeds(track);if(!reelsState[panel])reelsState[panel]={};reelsState[panel].sys=sys;reelsState[panel].idx=0;reelsState[panel].len=videos.length;if(titleEl)titleEl.textContent=videos[0]?.title||'';updateReelUI(panel)}function updateReelUI(panel){const carousel=document.getElementById(`carouselReels-${panel}`);const state=reelsState[panel];if(!carousel||!state)return;const idx=state.idx;const slides=$$('.reel-slide',carousel);const dots=$$('.dot',carousel);slides.forEach((s,i)=>{const a=i===idx;s.classList.toggle('active',a);s.style.display=a?'':'none'});dots.forEach((d,i)=>d.classList.toggle('active',i===idx))}function goToReelSlide(panel,newIndex){const state=reelsState[panel];if(!state||!state.len)return;const idx=((newIndex%state.len)+state.len)%state.len;if(idx===state.idx)return;pauseAllYouTubeVideos();state.idx=idx;updateReelUI(panel)}function changeReelSlide(panel,delta){const state=reelsState[panel];if(!state||!state.len)return;goToReelSlide(panel,state.idx+delta)}function initReels(){const tabs=$$('.reel-sys-tabs .reel-tab');if(!tabs.length)return;const panels=new Set;tabs.forEach(tab=>{const panel=tab.dataset.panel;if(panel)panels.add(panel);tab.addEventListener('click',()=>{const p=tab.dataset.panel;const s=tab.dataset.sys;if(!p||!s)return;const group=tab.closest('.reel-sys-tabs');if(group){$$('.reel-tab',group).forEach(t=>t.classList.toggle('active',t===tab))}setReelSystem(p,s)})});panels.forEach(panel=>{const carousel=document.getElementById(`carouselReels-${panel}`);if(!carousel)return;const prev=$('.prev',carousel);const next=$('.next',carousel);prev&&prev.addEventListener('click',()=>changeReelSlide(panel,-1));next&&next.addEventListener('click',()=>changeReelSlide(panel,1));const initialTab=$(`.reel-sys-tabs .reel-tab.active[data-panel="${panel}"]`)||$(`.reel-sys-tabs .reel-tab[data-panel="${panel}"]`);if(initialTab)setReelSystem(panel,initialTab.dataset.sys)})}const HERO_GALLERY_DATA={contable:{label:'Solución Contable',systems:{contabilidad:{label:'CONTPAQi Contabilidad',images:[{src:'IMG/contabilidad.webp',alt:'CONTPAQi Contabilidad'}]},nominas:{label:'CONTPAQi Nóminas',images:[{src:'IMG/nominas.webp',alt:'CONTPAQi Nóminas'}]},bancos:{label:'CONTPAQi Bancos',images:[{src:'IMG/bancossq.webp',alt:'CONTPAQi Bancos'}]},xml:{label:'XML en Línea+',images:[{src:'IMG/xml.webp',alt:'XML en Línea+'}]}}},comercial:{label:'Solución Comercial',systems:{comercialstart:{label:'Comercial Start',images:[{src:'IMG/comercialstart.webp',alt:'CONTPAQi Comercial Start'}]},comercialpro:{label:'Comercial Pro',images:[{src:'IMG/comercialpro.webp',alt:'CONTPAQi Comercial Pro'}]},comercialpremium:{label:'Comercial Premium',images:[{src:'IMG/comercialpremium.webp',alt:'CONTPAQi Comercial Premium'}]},factura:{label:'Factura Electrónica',images:[{src:'IMG/factura.webp',alt:'Factura electrónica CONTPAQi'}]}}},nube:{label:'Productos en la nube',systems:{contabiliza:{label:'Contabiliza',images:[{src:'IMG/contabiliza.webp',alt:'Contabiliza en la nube'}]},analiza:{label:'Analiza',images:[{src:'IMG/analiza.webp',alt:'Analiza BI'}]},despachos:{label:'Despachos',images:[{src:'IMG/despachos.webp',alt:'Despachos contables en la nube'}]},vende:{label:'Vende',images:[{src:'IMG/vende.webp',alt:'Vende punto de venta'}]}}},productividad:{label:'Productividad y clima laboral',systems:{evalua:{label:'Evalúa',images:[{src:'IMG/evalua.webp',alt:'Evalúa clima laboral'}]},colabora:{label:'Colabora',images:[{src:'IMG/colabora.webp',alt:'Colabora app'}]},personia:{label:'Personia',images:[{src:'IMG/personia.webp',alt:'Personia expedientes'}]}}}};const heroGalleryState={groupKey:null,systemKey:null,index:0};function renderHeroGroups(){const nav=document.getElementById('heroGalleryGroups');if(!nav)return;nav.innerHTML='';Object.entries(HERO_GALLERY_DATA).forEach(([key,group],idx)=>{const btn=document.createElement('button');btn.type='button';btn.className='hero-group-btn';if(idx===0)btn.classList.add('active');btn.dataset.group=key;btn.textContent=group.label;btn.addEventListener('click',()=>{$$('.hero-group-btn',nav).forEach(b=>b.classList.toggle('active',b===btn));setHeroGroup(key)});nav.appendChild(btn)})}function renderHeroSystemTabs(groupKey){const tabs=document.getElementById('heroGalleryTabs');if(!tabs)return;const group=HERO_GALLERY_DATA[groupKey];if(!group)return;tabs.innerHTML='';Object.entries(group.systems).forEach(([sysKey,sys],idx)=>{const btn=document.createElement('button');btn.type='button';btn.className='hero-sys-tab';if(idx===0)btn.classList.add('active');btn.dataset.sys=sysKey;btn.textContent=sys.label;btn.addEventListener('click',()=>{$$('.hero-sys-tab',tabs).forEach(b=>b.classList.toggle('active',b===btn));setHeroSystem(sysKey)});tabs.appendChild(btn)})}function renderHeroSlides(groupKey,systemKey){const carousel=document.getElementById('heroGalleryCarousel');if(!carousel)return;const track=$('.carousel-track',carousel);const nav=$('.carousel-nav',carousel);const titleEl=document.getElementById('heroGalleryTitle');if(!track||!nav)return;const group=HERO_GALLERY_DATA[groupKey];const sys=group?.systems?.[systemKey];if(!sys)return;heroGalleryState.index=0;track.innerHTML='';nav.innerHTML='';sys.images.forEach((imgData,idx)=>{const slide=document.createElement('div');slide.className='hero-slide';slide.dataset.index=String(idx);slide.innerHTML=`<img src="${imgData.src}" alt="${imgData.alt||sys.label}" loading="lazy" decoding="async">`;track.appendChild(slide);const dot=document.createElement('button');dot.type='button';dot.className='dot';dot.setAttribute('aria-label',`Imagen ${idx+1}`);dot.addEventListener('click',()=>setHeroSlide(idx));nav.appendChild(dot)});if(titleEl)titleEl.textContent=sys.label;updateHeroSlidesUI()}function updateHeroSlidesUI(){const carousel=document.getElementById('heroGalleryCarousel');if(!carousel)return;const idx=heroGalleryState.index;const slides=$$('.hero-slide',carousel);const dots=$$('.dot',carousel);slides.forEach((s,i)=>{const a=i===idx;s.classList.toggle('active',a);s.style.display=a?'':'none'});dots.forEach((d,i)=>d.classList.toggle('active',i===idx))}function setHeroSlide(newIdx){const carousel=document.getElementById('heroGalleryCarousel');if(!carousel)return;const slides=$$('.hero-slide',carousel);if(!slides.length)return;const max=slides.length;const idx=((newIdx%max)+max)%max;heroGalleryState.index=idx;updateHeroSlidesUI()}function changeHeroSlide(delta){const carousel=document.getElementById('heroGalleryCarousel');if(!carousel)return;const slides=$$('.hero-slide',carousel);if(!slides.length)return;setHeroSlide(heroGalleryState.index+delta)}function setHeroGroup(groupKey){heroGalleryState.groupKey=groupKey;renderHeroSystemTabs(groupKey);const group=HERO_GALLERY_DATA[groupKey];const firstSysKey=Object.keys(group.systems)[0];setHeroSystem(firstSysKey)}function setHeroSystem(systemKey){heroGalleryState.systemKey=systemKey;renderHeroSlides(heroGalleryState.groupKey,systemKey)}function initHeroGallery(){const carousel=document.getElementById('heroGalleryCarousel');if(!carousel)return;const prev=$('.prev',carousel);const next=$('.next',carousel);prev&&prev.addEventListener('click',()=>changeHeroSlide(-1));next&&next.addEventListener('click',()=>changeHeroSlide(1));renderHeroGroups();const firstGroupKey=Object.keys(HERO_GALLERY_DATA)[0];if(firstGroupKey)setHeroGroup(firstGroupKey)}document.addEventListener('DOMContentLoaded',()=>{initPartials();initClickableCards();initProductTabs();initPromoFilters();initContactForm();initHeroGallery();initReels();enhanceLiteEmbeds(document)});
